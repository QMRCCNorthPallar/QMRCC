<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <title>Photo Frame | QMRCC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="Create your custom photo frame with Malayalam name overlay.">
  <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon">
  <link rel="icon" href="images/favicon.png" type="image/x-icon">

  <!-- Google Fonts: Rubik + Anek Malayalam -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anek+Malayalam:wght@400;700&family=Rubik:wght@400;500;700&display=swap"
    rel="stylesheet">
  <!-- Main Style Sheet -->
  <link rel="stylesheet" href="css/style.css">
  <!-- CROPRO CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropro@2.0.1/dist/cropro.min.css">

  <style>
    body {
      background: #f7faf7;
      color: #1a3d2b;
      font-family: 'Rubik', sans-serif;
      margin: 0;
      padding: 0;
    }

    .photo-frame-container {
      background: #fff;
      border-radius: 1.5rem;
      box-shadow: 0 4px 32px rgba(0, 0, 0, 0.12);
      padding: 2.5rem 1.5rem 2rem 1.5rem;
      margin: 2.5rem auto;
      max-width: 500px;
      color: inherit;
      position: relative;
    }

    .photo-frame-title {
      font-size: 2.2rem;
      font-weight: 700;
      color: #1fa463;
      margin-bottom: 1.5rem;
      text-align: center;
      letter-spacing: 0.02em;
    }

    .photo-frame-label {
      font-weight: 500;
      margin-bottom: 0.5rem;
      display: block;
      color: #1fa463;
      font-size: 1.08rem;
    }

    .photo-frame-input,
    .photo-frame-text {
      width: 100%;
      padding: 0.65rem 1.1rem;
      border-radius: 0.7rem;
      border: 1.5px solid #1fa463;
      background: #f7faf7;
      color: #1a3d2b;
      margin-bottom: 1.2rem;
      font-size: 1.08rem;
      outline: none;
      transition: border 0.2s;
    }

    .photo-frame-input:focus,
    .photo-frame-text:focus {
      border-color: #2be08a;
    }

    .photo-frame-btn {
      background: linear-gradient(90deg, #1fa463 60%, #2be08a 100%);
      color: #fff;
      border: none;
      border-radius: 0.7rem;
      padding: 0.8rem 2rem;
      font-size: 1.15rem;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 0.5rem;
      margin-top: 0.5rem;
      box-shadow: 0 2px 8px rgba(31, 164, 99, 0.08);
      transition: background 0.2s, color 0.2s;
      display: inline-block;
    }

    .photo-frame-btn:hover,
    .photo-frame-btn:focus {
      background: linear-gradient(90deg, #2be08a 60%, #1fa463 100%);
      color: #0d2d1e;
    }

    .photo-frame-canvas-wrap {
      background: #e7f5e7;
      border-radius: 1.2rem;
      padding: 1.2rem;
      margin-bottom: 1.3rem;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      min-height: 320px;
      max-width: 100%;
      overflow: auto;
      border: 1.5px solid #1fa463;
      box-shadow: 0 2px 12px rgba(31, 164, 99, 0.07);
    }

    .photo-frame-canvas {
      border-radius: 1rem;
      background: #fff;
      max-width: 100%;
      height: auto;
      box-shadow: 0 1px 8px rgba(0, 0, 0, 0.10);
      display: block;
      touch-action: none;
      border: 1px solid #e0e0e0;
    }

    .photo-frame-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
      justify-content: center;
      margin-bottom: 1.1rem;
      align-items: center;
    }

    .photo-frame-slider {
      width: 110px;
      margin: 0.5rem 0;
      accent-color: #1fa463;
    }

    @media (max-width: 600px) {
      .photo-frame-container {
        padding: 1rem 0.2rem;
        border-radius: 0.7rem;
      }

      .photo-frame-title {
        font-size: 1.3rem;
      }

      .photo-frame-canvas-wrap {
        min-height: 220px;
        padding: 0.5rem;
      }
    }
  </style>
</head>

<body>
  <div class="photo-frame-container">
    <div class="photo-frame-title">Photo Frame</div>
    <div class="photo-frame-label">Your Name (Malayalam):</div>
    <input class="photo-frame-text" type="text" id="photoFrameName" placeholder="നിങ്ങളുടെ പേര്" maxlength="32"
      style="font-family:'Anek Malayalam',sans-serif;">
    <div class="photo-frame-controls">
      <label style="margin:0 0.5rem 0 0.5rem; color:#1fa463;">Text Size</label>
      <input type="range" min="20" max="80" step="1" value="36" id="textSizeSlider" class="photo-frame-slider">
    </div>
    <div class="photo-frame-label">Upload your photo (JPG/PNG):</div>
    <input class="photo-frame-input" type="file" id="photoFrameImage" accept="image/png, image/jpeg">
    <div class="photo-frame-canvas-wrap">
      <canvas id="photoFrameCanvas" class="photo-frame-canvas" width="800" height="800"></canvas>
    </div>
    <button class="photo-frame-btn" id="downloadBtn"><i class="fas fa-download"></i> Download Image</button>
    <div style="font-size:0.95em; color:#888; margin-top:1rem; text-align:center;">
      All processing is done in your browser. No data is uploaded.
    </div>
  </div>

  <!-- CROPRO JS -->
  <script src="https://cdn.jsdelivr.net/npm/cropro@2.0.1/dist/cropro.min.js"></script>
  <script>
    // --- State ---
    let userImgObj = null,
      frameImg = null;
    let textSize = 36;
    let nameText = '';
    const CANVAS_SIZE = 800; // Use high-res for better quality

    // --- Elements ---
    const canvas = document.getElementById('photoFrameCanvas');
    const ctx = canvas.getContext('2d');
    const nameInput = document.getElementById('photoFrameName');
    const textSizeSlider = document.getElementById('textSizeSlider');
    const downloadBtn = document.getElementById('downloadBtn');
    const photoFrameImage = document.getElementById('photoFrameImage');

    // --- Load frame image ---
    frameImg = new window.Image();
    frameImg.src = 'images/frame/frame.png';
    frameImg.onload = drawAll;
    // Draw frame even before image upload
    drawAll();

    // --- Name input ---
    nameInput.addEventListener('input', function () {
      nameText = nameInput.value;
      drawAll();
    });

    textSizeSlider.addEventListener('input', function () {
      textSize = parseInt(this.value, 10);
      drawAll();
    });

    // --- Image upload & CROPRO ---
    photoFrameImage.addEventListener('change', function (e) {
      if (!e.target.files[0]) return;
      let file = e.target.files[0];
      if (!file.type.match(/^image\/(jpeg|png)$/)) {
        alert('Please upload a JPG or PNG image.');
        return;
      }
      let reader = new FileReader();
      reader.onload = function (ev) {
        Cropro.show({
          src: ev.target.result,
          aspectRatio: 1,
          onApply: function (croppedDataUrl) {
            userImgObj = new window.Image();
            userImgObj.onload = drawAll;
            userImgObj.src = croppedDataUrl;
          }
        });
      };
      reader.readAsDataURL(file);
    });

    // --- Drawing Logic ---
    function drawAll() {
      ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
      // Draw user image (if any)
      if (userImgObj && userImgObj.complete) {
        ctx.drawImage(userImgObj, 0, 0, CANVAS_SIZE, CANVAS_SIZE);
      }
      // Draw frame (always)
      if (frameImg && frameImg.complete) {
        ctx.drawImage(frameImg, 0, 0, CANVAS_SIZE, CANVAS_SIZE);
      }
      // Draw name text (always)
      if (nameInput.value.trim().length > 0) {
        ctx.save();
        ctx.font = `bold ${textSize}px 'Anek Malayalam', sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.shadowColor = 'rgba(0,0,0,0.5)';
        ctx.shadowBlur = 4;
        ctx.fillStyle = '#fff';
        // Fixed position: bottom center, 70px above the border
        ctx.fillText(
          nameInput.value,
          CANVAS_SIZE / 2,
          CANVAS_SIZE - textSize * 1.2 - 70
        );
        ctx.restore();
      }
    }

    // --- Download ---
    downloadBtn.onclick = function () {
      let link = document.createElement('a');
      link.download = 'photo-frame.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    };
  </script>
</body>

</html>